[home](https://github.com/zeditor01/zowe_db2_tools/blob/main/docs/ZPDT_Build_Path.md)

# 3.2 DAF and UMS : PSI Deploy

Installing software for z/OS typically involves 4 Steps
1. Download the Portable Software Instance (PSI) from ShopZ to a ZFS file system on z/OS
2. Deploy the PSI (unpack it into the target z/OS datasets, and adjust z/OS parameters)   <<<--- This page
3. Customize the Software (creating instances of it, configuring connections, setting up ISPF panels etc...)
4. Installation Verification Testing 

## Scope of this page

This page provides a worked example of deploying the Portable Software Instance of Db2 Administration Foundation and Unified Management Server (DAF and UMS) from ShopZ download server to your z/OS image.

## Starting point

It is assumed that you have already downloaded the DAFUMS Portable Software Instance from ShopZ.


## z/OSMF Deployment Workflow

From z/OSMF Software Management, open Deployments and select "New" from the Actions Pulldown.


![deploy_dafums_01](/images/deploy_dafums_01.jpg)

Click on "Specify Properties of Deployment"

![deploy_dafums_02](/images/deploy_dafums_02.jpg)

Give it a name (DAFUMS)

![deploy_dafums_03](/images/deploy_dafums_03.jpg)

Click on "Select the software to deploy"

![deploy_dafums_04](/images/deploy_dafums_04.jpg)

Choose the Portable Software Instance radio button, and select the previously-downloaded DAFUMS PSI.

![deploy_dafums_05](/images/deploy_dafums_05.jpg)

Click on "Select the objective of this deployment"

![deploy_dafums_06](/images/deploy_dafums_06.jpg)

Indicate that we creating a new software instance, with a new CSI zone, into Systems "S0W1", and that this is not a z/OS Deployment.

![deploy_dafums_07](/images/deploy_dafums_07.jpg)

Click on "Check for missing SYSMODs"

![deploy_dafums_08](/images/deploy_dafums_08.jpg)

Uncheck both options. These checks are useful if you are applying incremental maintenance to an existing deploymemt, but they are not necessary for a brand new PSI.

![deploy_dafums_09](/images/deploy_dafums_09.jpg)

Click on "Configure the deployment"

![deploy_dafums_10](/images/deploy_dafums_10.jpg)

Welcome: This starts a wizard within the parent workflow that controls how the software will be laid down in our z/OS system. Take a moment to review the notes about the scope of the wizard.

![deploy_dafums_11](/images/deploy_dafums_11.jpg)

DLIBs: Yes, we do want to copy the distribution zone libraries (in addition to the target zone libraries).

![deploy_dafums_12](/images/deploy_dafums_12.jpg)

Model: Yes, we do want to used the CSI model of the source software.

![deploy_dafums_13](/images/deploy_dafums_13.jpg)

SMP/E Zones: Yes, we want to accept the default names for the SMP/E Zones.

![deploy_dafums_14](/images/deploy_dafums_14.jpg)

Datasets: Yes - we want to control the names of the datasets, and were they are stored. 

Selecting a simple and meaningful high level qualifier (HLQ) is essential for locating datasets for an installed software product. We will replace the SMP/E packaging prefix (CB.ST313199) and replace it with a HLQ of DAFUMS. Every z/OS site will have site-specific naming standards. We can be a bit lazy on our ZPDT environments.

We have a full set of Systems Managed Storage (SMS) Automatic Class Selection (ACS) rules to control where software is stored. This avoids us needing to worry about volume selection and such like. Just click the system-determined radio button.

![deploy_dafums_15](/images/deploy_dafums_15.jpg)

Review the changes to Dataset placement, to check it looks good.

![deploy_dafums_16](/images/deploy_dafums_16.jpg)

Catalogs: Client sites will probably have multiple different ICF Catalogs. For a small ZPDT test system, we will just accept the master catalog.

![deploy_dafums_17](/images/deploy_dafums_17.jpg)

Volumes and Storage Classe: CLick on past the Volumes and Storage classes page, which is taken care of by our SMS environment.

![deploy_dafums_18](/images/deploy_dafums_18.jpg)

ZFS Mount Points. Select all ZFS datasets, and choose modify from the Actions pull down to edit the mount point. Get rid of the /applroot/CB/ST313199 prefix to leave the z/OS standard mount point for the software.

![deploy_dafums_19](/images/deploy_dafums_19.jpg)

Click on "Define Job Settings"

![deploy_dafums_20](/images/deploy_dafums_20.jpg)

Note the JCL dataset name, and review the Job Card.

Everything that we have entered so far has been to enable z/OSMF to generate customised jobs that we can run directly on our z/OS environment. When we push "OK" z/OSMF will generate those jobs for us.

![deploy_dafums_21](/images/deploy_dafums_21.jpg)

Click on "Submit Deployment Jobs"

![deploy_dafums_22](/images/deploy_dafums_22.jpg)

Review the customised deployment job list. Tick the checkbox for the first job (Unzip datasets), and then choose "Submit" from the Actions pull down menu.

![deploy_dafums_23](/images/deploy_dafums_23.jpg)

After the job completes, go to ISPF option 3.4 and search for "DAFUMS.**" to eyeball the datasets that have been unpacked.

![deploy_dafums_24](/images/deploy_dafums_24.jpg)

Tick the checkbox for the second job (Install ZFS datasets), and then choose "Submit" from the Actions pull down menu.

![deploy_dafums_25](/images/deploy_dafums_25.jpg)

Check for completion

![deploy_dafums_26](/images/deploy_dafums_26.jpg)

And refresh the list of datasets under DAFUMS HLQ. You will notice the two extra ZFS datasets have been copied over.

![deploy_dafums_27](/images/deploy_dafums_27.jpg)

Click through Jobs 3 and 4, to rename the datasets ( get rid of the trailing # ) andtidy up the CSI.

![deploy_dafums_28](/images/deploy_dafums_28.jpg)

Click on "Perform Workflows"

![deploy_dafums_29](/images/deploy_dafums_29.jpg)

PSI software packages typically have two product-related workflows that are included in the SMP/E deployment workflow.



Tick the checkbox for the YOURORDER workflow. This is purely bundle of "FYI" notices.

![deploy_dafums_30](/images/deploy_dafums_30.jpg)



It is good to review all the notices if this is your first PSI deployment. However, after you've done a couple, most folks just select all steps and select "Override Complete" from the Actions pulldown menu,

![deploy_dafums_31](/images/deploy_dafums_31.jpg)

Now, select the POSTDEPLOY workload (which is ESSENTIAL) and select "Perform" from the Actions pulldown menu.

![deploy_dafums_32](/images/deploy_dafums_32.jpg)

Now you will see a sequence of post-deployment actions in a serial-execution workflow. We need to work our way through all the steps. Select 1.1 and Perform it.

![deploy_dafums_33](/images/deploy_dafums_33.jpg)

Answer: NO we do not have a saved customised properties file.

![deploy_dafums_34](/images/deploy_dafums_34.jpg)

Click through to 1.3, and Perform

![deploy_dafums_35](/images/deploy_dafums_35.jpg)

The workflow has generated a JCL job to read the properties variables from a standard file supplied with the PSI. Press Next, Submit the job, and check that it completes successfully.

![deploy_dafums_36](/images/deploy_dafums_36.jpg)

Most customer sites would choose to define RACF profiles for the product datasets. This is not necessary for a ZPDT system. Override Complete on the RACF profiles.

![deploy_dafums_37](/images/deploy_dafums_37.jpg)

Updating the Subsystem Parmlib is the step where things like APF-authorisations are defined. This product has none, so we click through to completion.

![deploy_dafums_38](/images/deploy_dafums_38.jpg)

Mounting ZFS file systems is increasingly common for all Z software products. Review the generated JCL to check which ZFS filesystems are to be mounted where. Press Next and Submit.

![deploy_dafums_39](/images/deploy_dafums_39.jpg)

Often this step will complete successfully. Normally it will create a new BPXPRMxx member with ZFS mount instructions that needs to be included at IPL time. I prefer to take the ZFS mount instructions myself, and include them in the BPXPRMZZ member for all the products I install.

In this case the job actually fails. You can lookup the error messages and reason codes. In this case the mount failed because another ZFS dataset is already mounted at the mountpoint for the DAFUMS.OMVS.SAFXROOT filesystem. 

![deploy_dafums_40](/images/deploy_dafums_40.jpg)

 
So, how did that happen ?

Well, I opened an SSH shell on z/OS and entered a df command to display all the ZFS filesystems that contain the strings AFX (for DAF) and IZP (for UMS).

I find that QWT.OMVS.SAFXROOT (which we deployed earlier as part of the QWT installation) is already mounted at /usr/lpp/IBM/afx/v1r2m0/bin

It turns out that this ZFS is supplied with multiple products, and it doesn't really matter which one we mount at /usr/lpp/IBM/afx/v1r2m0/bin

![deploy_dafums_41](/images/deploy_dafums_41.jpg)


So, I edit USER.Z31C.PARMLIB(BPXPRMZZ) and comment out the clashing ZFS filesystem from QWT, and mount the AFX and IZP filesystems from DAFUMS.

You can issue a z/OS command for z/OS to refresh it's ZFS mount points. Altrnatively you can re-IPL. Personally, for my ZPDT, I prefer to perform an IPL, because it confirms that I have edited USER.Z31C.PARMLIB(BPXPRMZZ) correctly.


![deploy_dafums_fix1](/images/deploy_dafums_fix1.jpg)

Since I performed the ZFS mounts myself, outside of the PSI Deloyment workflow, I perform an "Override Complete" on the step in the workflow.

![deploy_dafums_43](/images/deploy_dafums_43.jpg)

Perform the next step.

![deploy_dafums_44](/images/deploy_dafums_44.jpg)

Step UMS1.2.0 is just a note to the systems programmer about checking documentation

![deploy_dafums_45](/images/deploy_dafums_45.jpg)

CLick through all the remaining steps, which in this case are more motherhood and saving property variables files.

![deploy_dafums_46](/images/deploy_dafums_46.jpg)

Be satisfied that both workloads are complete.

![deploy_dafums_47](/images/deploy_dafums_47.jpg)


Select "Specify Properties"

![deploy_dafums_48](/images/deploy_dafums_48.jpg)

Confirm the name, and push OK to finish

![deploy_dafums_49](/images/deploy_dafums_49.jpg)

And marvel at the "Completed" Status of your DAFUMS PSI deployment.

![deploy_dafums_50](/images/deploy_dafums_50.jpg)


That's all folks.





[home](https://github.com/zeditor01/zowe_db2_tools/blob/main/docs/ZPDT_Build_Path.md)
